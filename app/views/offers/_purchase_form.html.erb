<% optional_products = @offer.offer_products.optional_in_stock.order('products.name') %>
<%= semantic_form_for [@offer, @purchase] do |f| %>
  <%= f.fields_for @customer do |fc| %>
    <%= fc.inputs do %>
      <%= fc.input :name %>
      <%= fc.input :email %>
      <%= fc.input :phone %>
      <%= fc.input :address, required: true %>
      <%= fc.input :country %>
      <%= fc.input :postcode, required: true %>
      <%  if optional_products.count > 0 %>
        <%= fc.input :product_id, as: :radio,
          collection: optional_products.map { |op| [op.product.name, op.product_id] } %>
      <%  end %>
    <% end %>
    <%= f.actions  do %>
      <% @offer.prices.each do |p| %>
        <% label = "<span class='price-name'>#{p.name}</span><br /><span class='price-desc'>#{p.description}</span>" %>
        <%= f.action :submit, as: :button, label: label.html_safe,
          button_html: { name: :price_id, value: p.id, class: 'btn btn-price btn-success',
            id: "purchase_submit_action_#{p.id}" } %>
      <% end %>
    <% end %>
  <% end %>
<% end %>
